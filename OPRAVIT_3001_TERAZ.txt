# üîß OPRAVI≈§ PORT 3001 ‚Üí 3000 TERAZ - Kop√≠rova≈• a spusti≈• na serveri

# === KROK 1: Zastavi≈• aktu√°lny proces ===
cd /var/www/premarketprice
pm2 stop premarketprice
pm2 delete premarketprice

# === KROK 2: Spusti≈• s explicitn√Ωm PORT=3000 ===
# D√îLE≈ΩIT√â: PORT=3000 mus√≠ by≈• PRED pm2 start
PORT=3000 pm2 start ecosystem.config.js --only premarketprice --env production

# === KROK 3: Poƒçka≈• a skontrolova≈• logy ===
sleep 10
pm2 logs premarketprice --lines 15

# ‚úÖ Mali by ste vidie≈•: "üöÄ Next.js server ready on http://localhost:3000"
# ‚ùå NIE: "üöÄ Next.js server ready on http://localhost:3001"

# === KROK 4: Skontrolova≈• porty (pou≈æi≈• ss namiesto netstat) ===
ss -tlnp | grep -E "3000|3001"

# Mali by ste vidie≈•: LISTEN 0 511 127.0.0.1:3000
# NIE: 127.0.0.1:3001

# === KROK 5: Spusti≈• workers ===
pm2 start ecosystem.config.js --only pmp-polygon-worker --env production
pm2 start ecosystem.config.js --only pmp-bulk-preloader --env production

# === KROK 6: Skontrolova≈• v≈°etky procesy ===
pm2 status

# Mali by ste vidie≈•:
# - premarketprice (online) - port 3000
# - pmp-polygon-worker (online)
# - pmp-bulk-preloader (online alebo waiting)

# === KROK 7: Ulo≈æi≈• ===
pm2 save

# === KROK 8: Skontrolova≈• logy workers ===
pm2 logs pmp-polygon-worker --lines 10
pm2 logs pmp-bulk-preloader --lines 10

