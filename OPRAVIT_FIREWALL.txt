# 游댠 OPRAVI콗 FIREWALL PRE LET'S ENCRYPT - Kop칤rova콘 a spusti콘 na serveri

# === KROK 1: Skontrolova콘, ak칳 firewall pou쮂셨ate ===
which ufw && echo "Pou쮂셨ate UFW" || echo "Pou쮂셨ate iptables"

# === KROK 2: Skontrolova콘 UFW status ===
ufw status

# === KROK 3: Otvori콘 porty 80 a 443 (ak s칰 zatvoren칠) ===
ufw allow 80/tcp
ufw allow 443/tcp

# === KROK 4: Skontrolova콘 iptables (ak nepou쮂셨ate UFW) ===
iptables -L -n | grep -E "80|443"

# === KROK 5: Ak port 80 je blokovan칳 v iptables, otvori콘 ho ===
iptables -I INPUT -p tcp --dport 80 -j ACCEPT
iptables -I INPUT -p tcp --dport 443 -j ACCEPT

# === KROK 6: Skontrolova콘, 캜i porty s칰 otvoren칠 ===
ss -tlnp | grep -E "80|443"

# Mali by ste vidie콘:
# LISTEN 0 511 *:80
# LISTEN 0 511 *:443

# === KROK 7: Sk칰si콘 znovu vygenerova콘 certifik치t ===
certbot certonly --nginx -d premarketprice.com -d www.premarketprice.com

# === KROK 8: Ak st치le zlyh치, pou쬴콘 DNS-01 challenge ===
# certbot certonly --manual --preferred-challenges dns -d premarketprice.com -d www.premarketprice.com

# === KROK 9: Po 칰spe코nom vygenerovan칤, skontrolova콘 certifik치ty ===
ls -la /etc/letsencrypt/live/premarketprice.com/

# === KROK 10: Reload Nginx ===
systemctl reload nginx

# === KROK 11: Testova콘 HTTPS ===
curl -k https://premarketprice.com/api/health

