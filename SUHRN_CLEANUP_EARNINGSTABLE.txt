# âœ… SÃšHRN - CLEANUP V EARNINGSTABLE.COM

## âœ… ÄŒO JE NASTAVENÃ‰:

1. **earnings-cron je spustenÃ½** âœ…
   - PM2 id: 8
   - Status: online
   - Timezone: America/New_York

2. **Daily Clear Job je naplÃ¡novanÃ½** âœ…
   - Schedule: `0 3 * * 1-5` (03:00 NY, Mon-Fri)
   - Valid: true
   - ÄŒo robÃ­: VymaÅ¾e starÃ© dÃ¡ta v tabuÄ¾ke `final_report` kaÅ¾dÃ½ pracovnÃ½ deÅˆ o 03:00 NY

3. **Pipeline je naplÃ¡novanÃ½** âœ…
   - Schedule: `*/5 * * * *` (kaÅ¾dÃ½ch 5 minÃºt, 24/7 okrem 03:00)
   - Valid: true
   - ÄŒo robÃ­: NaÄÃ­ta novÃ© earnings dÃ¡ta kaÅ¾dÃ½ch 5 minÃºt

## ğŸ“… KEDY SA PREMAZÃVA TABUÄ½KA:

- **ÄŒas**: 03:00 NY (New York time)
- **Dni**: Pondelok aÅ¾ Piatok (pracovnÃ© dni)
- **CET Äas (zima)**: 09:00 CET
- **CET Äas (leto)**: 08:00 CET (kvÃ´li DST)

## âš ï¸ AKTUÃLNY STAV DÃT:

- **PoÄet zÃ¡znamov**: 12
- **ProblÃ©m**: VÅ¡etky zÃ¡znamy majÃº:
  - `createdAt` = `2000-01-01 01:00:00` (placeholder)
  - `reportDate` = NULL
  - `snapshotDate` = NULL

**To znamenÃ¡**: DÃ¡ta sÃº starÃ© alebo neÃºplnÃ©. Po najbliÅ¾Å¡om cleanup (v pondelok o 03:00 NY) sa tabuÄ¾ka vymaÅ¾e a naÄÃ­tajÃº sa novÃ© dÃ¡ta.

## ğŸ” AKO SKONTROLOVAÅ¤, ÄŒI SA PREMAZÃVA:

```bash
# SkontrolovaÅ¥ logy po cleanup (v pondelok po 03:00 NY):
cd /var/www/earnings-table && \
pm2 logs earnings-cron --lines 200 --nostream | grep -i -E "(clear|delete|03:00|daily)" | tail -20

# SkontrolovaÅ¥, Äi sa zmenil poÄet zÃ¡znamov:
sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) FROM final_report;"

# SkontrolovaÅ¥, Äi majÃº novÃ© zÃ¡znamy skutoÄnÃ© dÃ¡tumy:
sqlite3 modules/database/prisma/prod.db "SELECT symbol, date(reportDate) as report_date, datetime(createdAt, 'localtime') as created FROM final_report LIMIT 5;"
```

## âœ… ZÃVER:

**ÃNO, tabuÄ¾ka sa premazÃ¡va pravidelne v noci!**
- KaÅ¾dÃ½ pracovnÃ½ deÅˆ (Po-Pi) o 03:00 NY
- Cron job je spustenÃ½ a naplÃ¡novanÃ½ sprÃ¡vne
- Dnes je sobota, takÅ¾e cron nebeÅ¾al (len Po-Pi)
- V pondelok o 03:00 NY (09:00 CET) sa tabuÄ¾ka automaticky vymaÅ¾e a naÄÃ­tajÃº sa novÃ© dÃ¡ta

