# ğŸš€ ÄALÅ IE KROKY - KopÃ­rovaÅ¥ a spustiÅ¥ na serveri

# === KROK 1: PoÄkaÅ¥ chvÃ­Ä¾u a skontrolovaÅ¥ logy ===
# Server sa mÃ´Å¾e eÅ¡te spÃºÅ¡Å¥aÅ¥. PoÄkajte 10-15 sekÃºnd
sleep 10

# === KROK 2: SkontrolovaÅ¥ logy ===
pm2 logs premarketprice --lines 30

# HÄ¾adaÅ¥:
# âœ… "ğŸš€ Next.js server ready on http://localhost:3000" (sprÃ¡vne)
# âŒ "ğŸš€ Next.js server ready on http://localhost:3001" (zlÃ©)

# === KROK 3: SkontrolovaÅ¥ porty ===
netstat -tlnp | grep -E "3000|3001"
# Mali by ste vidieÅ¥: 127.0.0.1:3000 (nie 3001)

# === KROK 4: SpustiÅ¥ workers (ak eÅ¡te nebeÅ¾ia) ===
pm2 status

# Ak chÃ½bajÃº workers, spustiÅ¥ ich:
pm2 start ecosystem.config.js --only pmp-polygon-worker --env production
pm2 start ecosystem.config.js --only pmp-bulk-preloader --env production

# === KROK 5: SkontrolovaÅ¥ vÅ¡etky procesy ===
pm2 status

# Mali by ste vidieÅ¥:
# - premarketprice (online)
# - pmp-polygon-worker (online)
# - pmp-bulk-preloader (online alebo waiting)

# === KROK 6: UloÅ¾iÅ¥ ===
pm2 save

# === KROK 7: Ak server beÅ¾Ã­ na porte 3001, opraviÅ¥ ===
# ReÅ¡tartovaÅ¥ s explicitnÃ½m PORT=3000
pm2 stop premarketprice
pm2 delete premarketprice
PORT=3000 pm2 start ecosystem.config.js --only premarketprice --env production
pm2 save

# === KROK 8: SkontrolovaÅ¥ logy workers ===
pm2 logs pmp-polygon-worker --lines 10
pm2 logs pmp-bulk-preloader --lines 10

