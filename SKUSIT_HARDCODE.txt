# üîß SK√öSI≈§ HARDCODE PORT 3000 - Kop√≠rova≈• a spusti≈• na serveri

# === KROK 1: Skontrolova≈•, ƒçi port 3000 nie je obsaden√Ω ===
ss -tlnp | grep 3000

# Ak je obsaden√Ω, zisti≈• ktor√Ωm procesom a zastavi≈• ho

# === KROK 2: Upravi≈• server.ts na serveri (doƒçasne hardcode port 3000) ===
cd /var/www/premarketprice

# Z√°lohova≈• p√¥vodn√Ω s√∫bor
cp server.ts server.ts.backup

# Upravi≈• server.ts - zmeni≈• riadok s portom
# N√°js≈•: const port = parseInt(process.env.PORT || '3000', 10);
# Zmeni≈• na: const port = 3000; // Force port 3000

# Alebo pou≈æi≈• sed:
sed -i "s/const port = parseInt(process.env.PORT || '3000', 10);/const port = 3000; \/\/ Force port 3000/g" server.ts

# === KROK 3: Skontrolova≈• zmenu ===
grep "const port" server.ts

# Mali by ste vidie≈•: const port = 3000; // Force port 3000

# === KROK 4: Re≈°tartova≈• ===
pm2 stop premarketprice
pm2 delete premarketprice
pm2 start ecosystem.config.js --only premarketprice --env production

# === KROK 5: Skontrolova≈• logy ===
sleep 10
pm2 logs premarketprice --lines 15

# ‚úÖ Mali by ste vidie≈•: "üöÄ Next.js server ready on http://localhost:3000"

# === KROK 6: Skontrolova≈• porty ===
ss -tlnp | grep -E "3000|3001"

# Mali by ste vidie≈•: LISTEN 0 511 127.0.0.1:3000
# NIE: *:3001

# === KROK 7: Ak to funguje, m√¥≈æete vr√°ti≈• p√¥vodn√Ω server.ts ===
# cp server.ts.backup server.ts
# A potom rie≈°i≈•, preƒço process.env.PORT nefunguje

