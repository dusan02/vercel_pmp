cd /var/www/premarketprice && \
echo "=== 0. NÁJSŤ DATABÁZU ===" && \
DB_PATH="" && \
[ -f "prisma/data/premarket.db" ] && DB_PATH="prisma/data/premarket.db" || \
[ -f "prisma/prod.db" ] && DB_PATH="prisma/prod.db" || \
[ -f "prisma/dev.db" ] && DB_PATH="prisma/dev.db" || \
DB_PATH=$(find . -maxdepth 3 -name "*.db" -type f 2>/dev/null | grep -E "(premarket|prod|dev)" | head -1) && \
if [ -z "$DB_PATH" ] || [ ! -f "$DB_PATH" ]; then \
  echo "❌ Databáza nebola nájdená! Hľadám všetky .db súbory..." && \
  find . -name "*.db" -type f 2>/dev/null | head -5 && \
  exit 1; \
fi && \
echo "✅ Používam databázu: $DB_PATH" && \
echo "" && \
echo "=== 1. TICKERY S sharesOutstanding = 0 alebo NULL (a majú cenu aj prevClose) ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, sharesOutstanding, lastPrice, latestPrevClose, lastMarketCap, lastMarketCapDiff FROM Ticker WHERE (sharesOutstanding IS NULL OR sharesOutstanding = 0) AND lastPrice > 0 AND latestPrevClose > 0 ORDER BY lastMarketCap DESC LIMIT 20;" 2>/dev/null || echo "⚠️ Chyba" && \
echo "" && \
echo "=== 2. TOP 20 SPOLOČNOSTÍ PODĽA MARKET CAP ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, sharesOutstanding, lastPrice, latestPrevClose, lastMarketCap, lastMarketCapDiff FROM Ticker WHERE lastMarketCap > 0 ORDER BY lastMarketCap DESC LIMIT 20;" 2>/dev/null || echo "⚠️ Chyba" && \
echo "" && \
echo "=== 3. POČET TICKEROV S sharesOutstanding = 0 alebo NULL ===" && \
sqlite3 "$DB_PATH" "SELECT COUNT(*) as pocet FROM Ticker WHERE (sharesOutstanding IS NULL OR sharesOutstanding = 0) AND lastPrice > 0;" 2>/dev/null || echo "⚠️ Chyba" && \
echo "" && \
echo "=== 4. TICKERY S percentChange ALE BEZ marketCapDiff (PROBLÉM!) ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, lastChangePct, lastMarketCapDiff, sharesOutstanding, lastPrice, latestPrevClose FROM Ticker WHERE lastChangePct IS NOT NULL AND lastChangePct != 0 AND (lastMarketCapDiff IS NULL OR lastMarketCapDiff = 0) AND lastPrice > 0 AND latestPrevClose > 0 ORDER BY ABS(lastChangePct) DESC LIMIT 20;" 2>/dev/null || echo "⚠️ Chyba" && \
echo "" && \
echo "✅ Hotovo!"

