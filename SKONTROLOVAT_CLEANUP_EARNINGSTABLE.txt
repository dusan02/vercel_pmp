# üîç SKONTROLOVA≈§, ƒåI SA PREMAZ√ÅVA TABUƒΩKA V NOCI - earnings-table

cd /var/www/earnings-table && \
echo "=== 1. PM2 STATUS - earnings-cron ===" && \
pm2 list | grep -E "(earnings-cron|earnings-table)" && \
echo "" && \
echo "=== 2. ECOSYSTEM CONFIG - CRON SCHEDULE ===" && \
cat ecosystem.config.js | grep -A 15 "earnings-cron" | head -20 && \
echo "" && \
echo "=== 3. DATAB√ÅZA - ƒåAS √öPRAVY ===" && \
ls -lh modules/database/prisma/prod.db && \
echo "" && \
echo "=== 4. DATAB√ÅZA - POSLEDN√â Z√ÅZNAMY (kedy boli vytvoren√©) ===" && \
sqlite3 modules/database/prisma/prod.db "SELECT datetime(createdAt, 'localtime') as created, symbol, date(reportDate) as report_date FROM final_report ORDER BY createdAt DESC LIMIT 10;" 2>/dev/null || echo "‚ö†Ô∏è Chyba pri ƒç√≠tan√≠ datab√°zy" && \
echo "" && \
echo "=== 5. DATAB√ÅZA - NAJSTAR≈†IE Z√ÅZNAMY ===" && \
sqlite3 modules/database/prisma/prod.db "SELECT datetime(createdAt, 'localtime') as created, symbol, date(reportDate) as report_date FROM final_report ORDER BY createdAt ASC LIMIT 5;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 6. DATAB√ÅZA - POƒåET Z√ÅZNAMOV PODƒΩA D√ÅTUMU VYTVORENIA ===" && \
sqlite3 modules/database/prisma/prod.db "SELECT date(createdAt, 'localtime') as datum, COUNT(*) as pocet FROM final_report GROUP BY date(createdAt, 'localtime') ORDER BY datum DESC LIMIT 10;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 7. DATAB√ÅZA - KEDY BOLI Z√ÅZNAMY VYTVOREN√â (podƒæa hodiny) ===" && \
sqlite3 modules/database/prisma/prod.db "SELECT strftime('%Y-%m-%d %H:00', createdAt, 'localtime') as hodina, COUNT(*) as pocet FROM final_report GROUP BY strftime('%Y-%m-%d %H:00', createdAt, 'localtime') ORDER BY hodina DESC LIMIT 20;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 8. DATAB√ÅZA - CELKOV√ù POƒåET Z√ÅZNAMOV ===" && \
sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as celkovy_pocet FROM final_report;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 9. PM2 LOGY - earnings-cron (hƒæadanie 'clear', 'reset', 'delete') ===" && \
pm2 logs earnings-cron --lines 500 --nostream 2>&1 | grep -i -E "(clear|reset|delete|cleanup|03:00|daily|midnight)" | tail -30 || echo "‚ö†Ô∏è ≈Ωiadne logy alebo proces neexistuje" && \
echo "" && \
echo "=== 10. AKTU√ÅLNY ƒåAS NA SERVERI ===" && \
date && \
echo "" && \
echo "=== 11. AKTU√ÅLNY ƒåAS V AMERICA/NEW_YORK ===" && \
TZ=America/New_York date && \
echo "" && \
echo "=== 12. AKTU√ÅLNY DE≈á V T√ù≈ΩDNI (1=pondelok, 5=piatok) ===" && \
TZ=America/New_York date +"%u" && \
echo "" && \
echo "=== 13. CRON SCHEDULE INFO ===" && \
echo "Daily clear job by mal be≈æa≈•: 0 3 * * 1-5 (03:00 NY, Mon-Fri) = 09:00 CET (v zime) / 08:00 CET (v lete)"

