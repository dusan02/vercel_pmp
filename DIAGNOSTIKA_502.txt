# 游댌 DIAGNOSTIKA 502 BAD GATEWAY - Kop칤rova콘 a spusti콘 na serveri

# === KROK 1: Z치kladn칠 kontroly ===
# 1.1 Server be쮂?
ss -tlnp | grep 3000
# Mali by ste vidie콘: LISTEN 0 511 *:3000

# 1.2 Priame pripojenie funguje?
curl http://localhost:3000/api/health
# Mali by ste dosta콘 JSON (nie 502)

# === KROK 2: Skontrolova콘 Nginx konfigur치ciu ===
# 2.1 Ktor칰 konfigur치ciu pou쮂셨a?
nginx -T 2>&1 | grep "configuration file"

# 2.2 Upstream v aktu치lnej konfigur치cii?
nginx -T | grep -A 5 "upstream app_servers"
# Mali by ste vidie콘: server 127.0.0.1:3000

# 2.3 Earningstable.com server block?
nginx -T | grep -B 5 -A 25 "server_name.*earningstable.com"
# Mali by ste vidie콘:
# - listen 443 ssl http2
# - ssl_certificate /etc/letsencrypt/live/earningstable.com/fullchain.pem
# - proxy_pass http://app_servers

# === KROK 3: Skontrolova콘 error logy ===
tail -50 /var/log/nginx/error.log | grep -i -E "earningstable|502|upstream|connection"

# H쬬da콘:
# - "connection refused"
# - "upstream"
# - "502"

# === KROK 4: Skontrolova콘 sites-enabled ===
ls -la /etc/nginx/sites-enabled/
cat /etc/nginx/sites-enabled/* 2>/dev/null | grep -A 10 earningstable

# === KROK 5: Skontrolova콘, 캜i Nginx pou쮂셨a na코u konfigur치ciu ===
# N치코 nginx.conf: /var/www/premarketprice/nginx.conf
# Skontrolova콘, 캜i je v /etc/nginx/ alebo sites-enabled

grep -r "upstream app_servers" /etc/nginx/ 2>/dev/null
grep -r "earningstable.com" /etc/nginx/ 2>/dev/null

# === KROK 6: Ak Nginx nepou쮂셨a na코u konfigur치ciu ===
# Skop칤rova콘 na코u konfigur치ciu do spr치vneho miesta
# Alebo upravi콘 existuj칰cu konfigur치ciu

