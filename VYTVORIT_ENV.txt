# ðŸ”§ VYTVORIÅ¤ .env SÃšBOR - KopÃ­rovaÅ¥ a spustiÅ¥ na serveri

# === KROK 1: PrejsÅ¥ do adresÃ¡ra ===
cd /var/www/premarketprice

# === KROK 2: VytvoriÅ¥ .env sÃºbor s PORT=3000 ===
cat > .env << 'EOF'
PORT=3000
NODE_ENV=production
ENABLE_WEBSOCKET=true
EOF

# === KROK 3: SkontrolovaÅ¥ .env sÃºbor ===
cat .env

# Mali by ste vidieÅ¥:
# PORT=3000
# NODE_ENV=production
# ENABLE_WEBSOCKET=true

# === KROK 4: ZastaviÅ¥ aktuÃ¡lny proces ===
pm2 stop premarketprice
pm2 delete premarketprice

# === KROK 5: SpustiÅ¥ s .env sÃºborom ===
# PM2 automaticky naÄÃ­ta .env sÃºbor ak je v cwd
pm2 start ecosystem.config.js --only premarketprice --env production

# === KROK 6: PoÄkaÅ¥ a skontrolovaÅ¥ logy ===
sleep 10
pm2 logs premarketprice --lines 15

# âœ… Mali by ste vidieÅ¥: "ðŸš€ Next.js server ready on http://localhost:3000"
# âŒ NIE: "ðŸš€ Next.js server ready on http://localhost:3001"

# === KROK 7: SkontrolovaÅ¥ porty ===
ss -tlnp | grep -E "3000|3001"

# Mali by ste vidieÅ¥: LISTEN 0 511 127.0.0.1:3000
# NIE: *:3001

# === KROK 8: Ak stÃ¡le beÅ¾Ã­ na 3001, skÃºsiÅ¥ zmeniÅ¥ exec_mode na fork ===
# UpraviÅ¥ ecosystem.config.js - zmeniÅ¥ exec_mode: "cluster" na exec_mode: "fork"
# A instances: "max" na instances: 1

