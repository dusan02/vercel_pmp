# üîç SKONTROLOVA≈§ sharesOutstanding V DATAB√ÅZE (SQL pr√≠kaz)

cd /var/www/premarketprice && \
echo "=== 0. N√ÅJS≈§ DATAB√ÅZU ===" && \
DB_PATH="" && \
if [ -f "prisma/data/premarket.db" ]; then \
  DB_PATH="prisma/data/premarket.db"; \
elif [ -f "prisma/prod.db" ]; then \
  DB_PATH="prisma/prod.db"; \
elif [ -f "prisma/dev.db" ]; then \
  DB_PATH="prisma/dev.db"; \
else \
  echo "‚ö†Ô∏è Datab√°za nebola n√°jden√°! Sk√∫sim n√°js≈•..." && \
  find . -name "*.db" -type f 2>/dev/null | grep -E "(premarket|prod|dev)" | head -1 | while read db; do \
    DB_PATH="$db"; \
    break; \
  done; \
fi && \
if [ -z "$DB_PATH" ] || [ ! -f "$DB_PATH" ]; then \
  echo "‚ùå Datab√°za nebola n√°jden√°!" && \
  echo "Sk√∫ste: find /var/www/premarketprice -name '*.db' -type f" && \
  exit 1; \
fi && \
echo "‚úÖ Pou≈æ√≠vam datab√°zu: $DB_PATH" && \
echo "" && \
echo "=== 1. SKONTROLOVA≈§, KTOR√â TICKERY MAJ√ö sharesOutstanding = 0 alebo NULL ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, sharesOutstanding, lastPrice, latestPrevClose, lastMarketCap, lastMarketCapDiff FROM Ticker WHERE (sharesOutstanding IS NULL OR sharesOutstanding = 0) AND lastPrice > 0 AND latestPrevClose > 0 ORDER BY lastMarketCap DESC LIMIT 20;" 2>/dev/null || echo "‚ö†Ô∏è Chyba pri ƒç√≠tan√≠ datab√°zy" && \
echo "" && \
echo "=== 2. SKONTROLOVA≈§ VEƒΩK√â SPOLOƒåNOSTI (top 20 podƒæa market cap) ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, sharesOutstanding, lastPrice, latestPrevClose, lastMarketCap, lastMarketCapDiff FROM Ticker WHERE lastMarketCap > 0 ORDER BY lastMarketCap DESC LIMIT 20;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 3. POƒåET TICKEROV S sharesOutstanding = 0 alebo NULL ===" && \
sqlite3 "$DB_PATH" "SELECT COUNT(*) as pocet FROM Ticker WHERE (sharesOutstanding IS NULL OR sharesOutstanding = 0) AND lastPrice > 0;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "=== 4. PR√çKLADY TICKEROV S percentChange ALE BEZ marketCapDiff ===" && \
sqlite3 "$DB_PATH" "SELECT symbol, name, lastChangePct, lastMarketCapDiff, sharesOutstanding, lastPrice, latestPrevClose FROM Ticker WHERE lastChangePct IS NOT NULL AND lastChangePct != 0 AND (lastMarketCapDiff IS NULL OR lastMarketCapDiff = 0) AND lastPrice > 0 AND latestPrevClose > 0 ORDER BY ABS(lastChangePct) DESC LIMIT 20;" 2>/dev/null || echo "‚ö†Ô∏è Chyba" && \
echo "" && \
echo "‚úÖ Hotovo!"

