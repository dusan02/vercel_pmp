cd /var/www/premarketprice && \
echo "=== 1. NÁJDEM TICKERY BEZ SHARES OUTSTANDING ===" && \
DB="prisma/data/premarket.db" && \
sqlite3 "$DB" "SELECT symbol, name, lastMarketCap, lastPrice, latestPrevClose, lastChangePct, lastMarketCapDiff, sharesOutstanding FROM Ticker WHERE (sharesOutstanding IS NULL OR sharesOutstanding = 0) AND lastMarketCap > 1000 ORDER BY lastMarketCap DESC LIMIT 10;" && \
echo "" && \
echo "=== 2. VYMAŽEM SHARES OUTSTANDING PRE NVDA (test) ===" && \
sqlite3 "$DB" "UPDATE Ticker SET sharesOutstanding = NULL WHERE symbol = 'NVDA';" && \
echo "✅ NVDA sharesOutstanding vymazané" && \
echo "" && \
echo "=== 3. TEST API S NVDA (bez shares) ===" && \
curl -s "http://localhost:3000/api/stocks?tickers=NVDA" > /dev/null && \
echo "✅ API hit" && \
sleep 3 && \
echo "" && \
echo "=== 4. LOGS (hľadanie Method B/B2 pre NVDA) ===" && \
pm2 logs premarketprice --lines 100 --nostream 2>&1 | grep -E "(NVDA|Method B|Method B2|calculatedPct|PERSIST TRY)" | tail -20 && \
echo "" && \
echo "=== 5. DB CHECK - NVDA ===" && \
sqlite3 "$DB" "SELECT symbol, lastMarketCap, lastMarketCapDiff, lastPrice, latestPrevClose, sharesOutstanding FROM Ticker WHERE symbol = 'NVDA';" && \
echo "" && \
echo "=== 6. OBNOVENIE SHARES OUTSTANDING PRE NVDA ===" && \
sqlite3 "$DB" "UPDATE Ticker SET sharesOutstanding = 24305000000 WHERE symbol = 'NVDA';" && \
echo "✅ NVDA sharesOutstanding obnovené"

