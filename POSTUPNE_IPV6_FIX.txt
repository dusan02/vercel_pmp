# üîß POSTUPN√â PR√çKAZY - OPRAVA IPv6 A OVERENIE

# ============================================
# KROK 1: N√°js≈• konfiguraƒçn√© s√∫bory
# ============================================
ls -la /etc/nginx/sites-enabled/

# ============================================
# KROK 2: Skontrolova≈•, ƒçi existuje IPv6 listen
# ============================================
grep -r "listen \[::\]" /etc/nginx/sites-enabled/
grep -r "listen \[::\]" /etc/nginx/nginx.conf

# ============================================
# KROK 3: Zobrazi≈• aktu√°lnu konfigur√°ciu
# ============================================
# Ak existuje s√∫bor premarketprice.com:
cat /etc/nginx/sites-enabled/premarketprice.com

# Alebo skontrolova≈• nginx.conf:
grep -A 30 "premarketprice.com" /etc/nginx/nginx.conf

# ============================================
# KROK 4: Upravi≈• konfigur√°ciu (manu√°lne)
# ============================================
# Otvori≈• s√∫bor:
nano /etc/nginx/sites-enabled/premarketprice.com
# ALEBO:
nano /etc/nginx/nginx.conf

# V SSL server blocku:
# ‚úÖ MUS√ç BY≈§:
# listen 80;
# listen 443 ssl;
#
# ‚ùå NESPR√ÅVNE (zakomentova≈• alebo zmaza≈•):
# listen [::]:443 ssl;
# listen [::]:80;

# ============================================
# KROK 5: Automatick√© odstr√°nenie IPv6
# ============================================
# Ak je v sites-enabled:
sed -i 's/listen \[::\]:443 ssl;/# listen [::]:443 ssl;/g' /etc/nginx/sites-enabled/premarketprice.com
sed -i 's/listen \[::\]:80;/# listen [::]:80;/g' /etc/nginx/sites-enabled/premarketprice.com

# Ak je v nginx.conf:
sed -i 's/listen \[::\]:443 ssl;/# listen [::]:443 ssl;/g' /etc/nginx/nginx.conf
sed -i 's/listen \[::\]:80;/# listen [::]:80;/g' /etc/nginx/nginx.conf

# ============================================
# KROK 6: Overi≈• server_name
# ============================================
# MUS√ç BY≈§:
# server_name premarketprice.com www.premarketprice.com;

# Skontrolova≈•:
grep -A 5 "listen 443 ssl" /etc/nginx/sites-enabled/premarketprice.com | grep server_name

# Alebo:
grep -A 5 "listen 443 ssl" /etc/nginx/nginx.conf | grep server_name

# ============================================
# KROK 7: Test Nginx syntax
# ============================================
nginx -t

# ============================================
# KROK 8: Re≈°tart Nginx
# ============================================
systemctl reload nginx

# Overenie:
systemctl status nginx

# ============================================
# KROK 9: Overi≈• SSL certifik√°t
# ============================================
certbot certificates

# Mali by ste vidie≈•:
# Domains: premarketprice.com www.premarketprice.com

# ============================================
# KROK 10: Test HTTPS (bez cache)
# ============================================
curl -Iv https://premarketprice.com

# V√Ωstup by mal obsahova≈•:
# - Server: nginx/1.22.1
# - subject: CN=premarketprice.com

# ============================================
# KROK 11: Detailn√Ω test SSL
# ============================================
openssl s_client -connect premarketprice.com:443 -servername premarketprice.com < /dev/null 2>/dev/null | openssl x509 -noout -subject -issuer -dates

# ============================================
# KROK 12: Overenie IPv6 (malo by by≈• vypnut√©)
# ============================================
ss -tlnp | grep nginx

# Mali by ste vidie≈• len IPv4 (0.0.0.0), nie [::]

