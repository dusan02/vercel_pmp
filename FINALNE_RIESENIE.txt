# ðŸš€ FINÃLNE RIEÅ ENIE - KopÃ­rovaÅ¥ a spustiÅ¥ na serveri

# === KROK 1: VytvoriÅ¥ .env sÃºbor ===
cd /var/www/premarketprice
cat > .env << 'EOF'
PORT=3000
NODE_ENV=production
ENABLE_WEBSOCKET=true
EOF

# === KROK 2: SkontrolovaÅ¥ .env ===
cat .env

# === KROK 3: ZastaviÅ¥ aktuÃ¡lny proces ===
pm2 stop premarketprice
pm2 delete premarketprice

# === KROK 4: SpustiÅ¥ s .env sÃºborom ===
pm2 start ecosystem.config.js --only premarketprice --env production

# === KROK 5: PoÄkaÅ¥ a skontrolovaÅ¥ logy ===
sleep 10
pm2 logs premarketprice --lines 15

# âœ… Mali by ste vidieÅ¥: "ðŸš€ Next.js server ready on http://localhost:3000"

# === KROK 6: SkontrolovaÅ¥ porty ===
ss -tlnp | grep -E "3000|3001"

# === KROK 7: SpustiÅ¥ workers ===
pm2 start ecosystem.config.js --only pmp-polygon-worker --env production
pm2 start ecosystem.config.js --only pmp-bulk-preloader --env production

# === KROK 8: UloÅ¾iÅ¥ ===
pm2 save
pm2 status

