# üìã S√öHRN PROBL√âMOV S PREMARKETPRICE.COM A ICH RIE≈†ENIA

## üî¥ HLAVN√â PROBL√âMY:

### 1. **502 Bad Gateway Error**
- **Pr√≠ƒçina:** Nginx redirectoval HTTP ‚Üí HTTPS, ale SSL certifik√°ty ch√Ωbali
- **Rie≈°enie:** Vygenerovali sme SSL certifik√°ty pomocou Certbot

### 2. **SSL Certifik√°t - Firewall Blokoval Port 80**
- **Chyba:** 
  ```
  Network unreachable / Timeout during connect (likely firewall problem)
  ```
- **Pr√≠ƒçina:** Let's Encrypt potrebuje port 80 pre HTTP-01 challenge, ale firewall ho blokoval
- **Rie≈°enie:** 
  - Otvorili sme porty 80 a 443 (iptables, nie ufw - ufw nebol nain≈°talovan√Ω)
  - Alebo pou≈æili DNS-01 challenge (nepotrebuje port 80)

### 3. **DNS Propag√°cia - Star√° IP Adresa**
- **Probl√©m:** DNS z√°znamy boli aktualizovan√© v Active24, ale trvalo to, k√Ωm sa propagovali
- **P√¥vodn√° IP:** 37.9.175.211 (star√°)
- **Nov√° IP:** 89.185.250.213 (spr√°vna)
- **Rie≈°enie:** 
  - Poƒçkali sme na DNS propag√°ciu
  - Overili sme pomocou `dig premarketprice.com +short`

### 4. **IPv6 AAAA Z√°znamy - Chaos**
- **Probl√©m:** Active24 automaticky prid√°valo AAAA (IPv6) z√°znamy, ale server nemal spr√°vne nastaven√© IPv6
- **Chyba:** HTTPS nefungoval, preto≈æe prehliadaƒçe sa pok√∫≈°ali pripoji≈• cez IPv6
- **Rie≈°enie:** 
  - Odstr√°nili sme IPv6 `listen` direkt√≠vy z Nginx konfigur√°cie
  - Zmenili sme z `listen [::]:443 ssl;` na `listen 443 ssl;` (len IPv4)
  - Pou≈æili sme `sed` na automatick√© odstr√°nenie IPv6

### 5. **DNS Cache na VPS - Server Si Pam√§tal Star√∫ IP**
- **Probl√©m:** Aj keƒè DNS z√°znamy boli spr√°vne, server si st√°le pam√§tal star√∫ IP adresu
- **Sympt√≥my:** 
  - `dig` ukazoval spr√°vnu IP
  - `curl` sa pok√∫≈°al pripoji≈• na star√∫ IP
- **Rie≈°enie:** 
  - Vyƒçistili sme DNS cache: `resolvectl flush-caches` alebo `systemd-resolve --flush-caches`
  - Re≈°tartovali sme DNS resolver: `systemctl restart systemd-resolved`
  - Skontrolovali sme `/etc/hosts` (nesmie obsahova≈• star√∫ IP)

### 6. **Nginx Konfigur√°cia - Duplicitn√Ω default_server**
- **Probl√©m:** Backup s√∫bor (`earningstable.com.backup`) obsahoval `default_server` direkt√≠vu
- **Chyba:** `nginx: configuration file /etc/nginx/nginx.conf test failed`
- **Rie≈°enie:** Odstr√°nili sme backup s√∫bor

## ‚úÖ FIN√ÅLNE RIE≈†ENIE:

### Postup, ktor√Ω fungoval:
1. ‚úÖ **Aktualizovali sme DNS z√°znamy v Active24** (A z√°znam ‚Üí 89.185.250.213)
2. ‚úÖ **Otvvorili sme porty 80 a 443** (iptables)
3. ‚úÖ **Vygenerovali sme SSL certifik√°t** (`certbot --nginx -d premarketprice.com -d www.premarketprice.com`)
4. ‚úÖ **Odstr√°nili sme IPv6 listen direkt√≠vy** z Nginx konfigur√°cie
5. ‚úÖ **Vyƒçistili sme DNS cache** na VPS
6. ‚úÖ **Overili sme, ≈æe `/etc/hosts` neobsahuje star√∫ IP**
7. ‚úÖ **Re≈°tartovali sme Nginx** (`systemctl restart nginx`)

## üîß KƒΩ√öƒåOV√â PR√çKAZY:

### SSL Setup:
```bash
apt update && apt install -y certbot python3-certbot-nginx
certbot --nginx -d premarketprice.com -d www.premarketprice.com
```

### IPv6 Fix:
```bash
sed -i 's/listen \[::\]:443 ssl;/# listen [::]:443 ssl;/g' /etc/nginx/sites-enabled/premarketprice.com
sed -i 's/listen \[::\]:80;/# listen [::]:80;/g' /etc/nginx/sites-enabled/premarketprice.com
nginx -t && systemctl reload nginx
```

### DNS Cache Cleanup:
```bash
resolvectl flush-caches
systemctl restart systemd-resolved
getent hosts premarketprice.com  # Overi≈•, ≈æe vid√≠ spr√°vnu IP
```

### Overenie:
```bash
curl -4Iv https://premarketprice.com  # MUS√ç uk√°za≈•: Trying 89.185.250.213:443
certbot certificates  # Overi≈•, ≈æe certifik√°t existuje
```

## üìù D√îLE≈ΩIT√â POZN√ÅMKY:

1. **DNS propag√°cia m√¥≈æe trva≈• 24-48 hod√≠n**, ale ƒçasto je to r√Ωchlej≈°ie
2. **IPv6 AAAA z√°znamy** m√¥≈æu sp√¥sobi≈• probl√©my, ak server nem√° spr√°vne nastaven√© IPv6
3. **DNS cache na serveri** m√¥≈æe dr≈æa≈• star√© IP adresy aj po DNS aktualiz√°cii
4. **Firewall** mus√≠ ma≈• otvoren√© porty 80 a 443 pre Let's Encrypt
5. **Nginx konfigur√°cia** mus√≠ ma≈• spr√°vne `server_name` pre obe dom√©ny (s www aj bez www)

## üéØ V√ùSLEDOK:

‚úÖ **premarketprice.com** teraz funguje s HTTPS
‚úÖ SSL certifik√°t je nastaven√Ω a auto-obnovuje sa
‚úÖ Nginx spr√°vne proxy-uje po≈æiadavky na port 3000
‚úÖ IPv6 probl√©my s√∫ vyrie≈°en√©
‚úÖ DNS cache je vyƒçisten√°

