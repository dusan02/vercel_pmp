# üîß R√ùCHLA OCHRANA PROTI IPv6 + OVERENIE KONFIGUR√ÅCIE

# ============================================
# KROK 1: N√°js≈• Nginx konfiguraƒçn√© s√∫bory
# ============================================
ls -la /etc/nginx/sites-enabled/

# ============================================
# KROK 2: Skontrolova≈• aktu√°lnu konfigur√°ciu
# ============================================
# N√°js≈• v≈°etky IPv6 listen direkt√≠vy:
grep -r "listen \[::\]" /etc/nginx/sites-enabled/

# Zobrazi≈• konfigur√°ciu pre premarketprice.com:
cat /etc/nginx/sites-enabled/premarketprice.com

# Alebo ak je v nginx.conf:
grep -A 20 "premarketprice.com" /etc/nginx/nginx.conf

# ============================================
# KROK 3: Upravi≈• konfigur√°ciu (odstr√°ni≈• IPv6)
# ============================================
# Otvori≈• konfiguraƒçn√Ω s√∫bor:
nano /etc/nginx/sites-enabled/premarketprice.com

# ALEBO ak je v nginx.conf:
nano /etc/nginx/nginx.conf

# V SSL server blocku MUS√ç BY≈§:
# ‚úÖ SPR√ÅVNE:
# listen 80;
# listen 443 ssl;
#
# ‚ùå NESPR√ÅVNE (IPv6):
# listen [::]:443 ssl;
# listen [::]:80;

# ============================================
# KROK 4: Automatick√© odstr√°nenie IPv6 (ak existuje)
# ============================================
# N√°js≈• a zakomentova≈• IPv6 listen:
sed -i 's/listen \[::\]:443 ssl;/# listen [::]:443 ssl;/g' /etc/nginx/sites-enabled/premarketprice.com
sed -i 's/listen \[::\]:80;/# listen [::]:80;/g' /etc/nginx/sites-enabled/premarketprice.com

# Alebo ak je v nginx.conf:
sed -i 's/listen \[::\]:443 ssl;/# listen [::]:443 ssl;/g' /etc/nginx/nginx.conf
sed -i 's/listen \[::\]:80;/# listen [::]:80;/g' /etc/nginx/nginx.conf

# ============================================
# KROK 5: Overi≈• server_name v SSL bloku
# ============================================
# MUS√ç BY≈§:
# server_name premarketprice.com www.premarketprice.com;
#
# Skontrolova≈•:
grep -A 5 "listen 443 ssl" /etc/nginx/sites-enabled/premarketprice.com | grep server_name

# Alebo:
grep -A 5 "listen 443 ssl" /etc/nginx/nginx.conf | grep server_name

# ============================================
# KROK 6: Overi≈• syntax Nginx
# ============================================
nginx -t

# ============================================
# KROK 7: Re≈°tart Nginx
# ============================================
systemctl reload nginx

# Overenie, ƒçi be≈æ√≠:
systemctl status nginx

# ============================================
# KROK 8: Overi≈• SSL certifik√°t
# ============================================
certbot certificates

# Spr√°vny v√Ωstup m√° obsahova≈•:
# Domains: premarketprice.com www.premarketprice.com

# ============================================
# KROK 9: Test bez prehliadaƒça (ob√≠de cache)
# ============================================
curl -Iv https://premarketprice.com

# Mali by ste vidie≈•:
# - Server: nginx/1.22.1
# - subject: CN=premarketprice.com (alebo podobn√©)

# ============================================
# KROK 10: Detailn√Ω test SSL certifik√°tu
# ============================================
openssl s_client -connect premarketprice.com:443 -servername premarketprice.com < /dev/null 2>/dev/null | openssl x509 -noout -subject -issuer -dates

# ============================================
# KROK 11: Overenie, ≈æe IPv6 nie je akt√≠vne
# ============================================
# Skontrolova≈•, ƒçi Nginx nepoƒç√∫va na IPv6:
ss -tlnp | grep nginx

# Mali by ste vidie≈• len IPv4 adresy (0.0.0.0 alebo 127.0.0.1), nie [::]

