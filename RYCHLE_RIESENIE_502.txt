# 游 R칗CHLE RIEENIE 502 - Kop칤rova콘 a spusti콘 na serveri

# === KROK 1: Skontrolova콘 SSL certifik치ty ===
ls -la /etc/letsencrypt/live/premarketprice.com/ 2>/dev/null || echo "Certifik치ty pre premarketprice.com neexistuj칰"
ls -la /etc/letsencrypt/live/earningstable.com/ 2>/dev/null || echo "Certifik치ty pre earningstable.com neexistuj칰"

# === KROK 2: Skontrolova콘, ktor칰 Nginx konfigur치ciu pou쮂셨a ===
nginx -T 2>&1 | grep "configuration file"
nginx -T | grep -A 3 "server_name.*premarketprice" | head -10

# === KROK 3: Do캜asne upravi콘 HTTP block, aby proxoval namiesto redirectu ===
# N치js콘 Nginx konfigura캜n칳 s칰bor
NGINX_CONF=$(nginx -T 2>&1 | grep "configuration file" | awk '{print $5}' | tr -d ';')

# Z치lohova콘
cp $NGINX_CONF ${NGINX_CONF}.backup

# Do캜asne vypn칰콘 HTTPS redirect a prida콘 proxy
# (Toto je zjednodu코en칠 - mo쬹o bude potrebn칠 upravi콘 manu치lne)

# === KROK 4: Alebo jednoduch코ie - vygenerova콘 SSL certifik치ty ===
# In코talova콘 certbot (ak nie je nain코talovan칳)
which certbot || (apt update && apt install certbot python3-certbot-nginx -y)

# Vygenerova콘 certifik치ty
certbot certonly --nginx -d premarketprice.com -d www.premarketprice.com --non-interactive --agree-tos --email your-email@example.com
certbot certonly --nginx -d earningstable.com -d www.earningstable.com --non-interactive --agree-tos --email your-email@example.com

# === KROK 5: Skontrolova콘, 캜i Nginx konfigur치cia pou쮂셨a spr치vne cesty k certifik치tom ===
nginx -T | grep -A 2 "ssl_certificate.*premarketprice"
nginx -T | grep -A 2 "ssl_certificate.*earningstable"

# === KROK 6: Reload Nginx ===
nginx -t && systemctl reload nginx

# === KROK 7: Testova콘 HTTPS ===
curl -k https://premarketprice.com/api/health
curl -k https://earningstable.com/api/health

