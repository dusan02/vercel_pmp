# 游댢 OPRAVI콗 NGINX 502 BAD GATEWAY - Kop칤rova콘 a spusti콘 na serveri

# === KROK 1: Skontrolova콘, 캜i server be쮂 na porte 3000 ===
ss -tlnp | grep 3000

# Mali by ste vidie콘: LISTEN 0 511 *:3000

# === KROK 2: Testova콘 priame pripojenie na port 3000 ===
curl http://localhost:3000/api/health
# Alebo
curl http://127.0.0.1:3000/api/health

# Mali by ste dosta콘 odpove캞 (nie 502)

# === KROK 3: Skontrolova콘 Nginx konfigur치ciu ===
nginx -t

# Mali by ste vidie콘: "syntax is ok" a "test is successful"

# === KROK 4: Skontrolova콘, 캜i Nginx be쮂 ===
systemctl status nginx

# Mali by ste vidie콘: "active (running)"

# === KROK 5: Skontrolova콘 Nginx error logy ===
tail -f /var/log/nginx/error.log
# Alebo
tail -20 /var/log/nginx/error.log

# H쬬da콘 chyby t칳kaj칰ce sa "upstream" alebo "connection refused"

# === KROK 6: Skontrolova콘 Nginx konfigur치ciu - upstream ===
grep -A 5 "upstream app_servers" /etc/nginx/nginx.conf
# Alebo ak je v /var/www/premarketprice/nginx.conf:
grep -A 5 "upstream app_servers" /var/www/premarketprice/nginx.conf

# Mali by ste vidie콘: server 127.0.0.1:3000

# === KROK 7: Skontrolova콘, 캜i je Nginx konfigur치cia na캜칤tan치 ===
# Nginx m칪쬰 pou쮂셨a콘 in칰 konfigur치ciu ako t칰, ktor칰 sme upravili
# Skontrolova콘, ktor칰 konfigur치ciu pou쮂셨a:
nginx -T | grep -A 5 "upstream app_servers"

# === KROK 8: Ak je upstream spr치vny, reload Nginx ===
systemctl reload nginx
# Alebo
systemctl restart nginx

# === KROK 9: Skontrolova콘 Nginx access logy ===
tail -20 /var/log/nginx/access.log

# === KROK 10: Testova콘 cez Nginx ===
curl http://localhost/api/health
# Alebo ak je HTTPS:
curl -k https://localhost/api/health

# === KROK 11: Ak st치le 502, skontrolova콘 firewall ===
# Mo쬹o firewall blokuje pripojenie z Nginx na port 3000
iptables -L -n | grep 3000
# Alebo
ufw status | grep 3000

