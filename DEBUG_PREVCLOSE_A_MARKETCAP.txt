cd /var/www/premarketprice && \
DB="prisma/data/premarket.db" && \
echo "=== DEBUG: Kontrola previousClose a marketCap pre NVDA ===" && \
echo "" && \
echo "=== 1. Hodnoty v DB ===" && \
sqlite3 "$DB" "SELECT 
  symbol,
  lastPrice as currentPrice,
  latestPrevClose as prevClose_DB,
  lastMarketCap as marketCap_DB,
  sharesOutstanding,
  lastChangePct
FROM Ticker 
WHERE symbol = 'NVDA';" 2>&1 && \
echo "" && \
echo "=== 2. Výpočet percentChange ===" && \
sqlite3 "$DB" "SELECT 
  symbol,
  lastPrice,
  latestPrevClose,
  CASE 
    WHEN latestPrevClose > 0 THEN ROUND(((lastPrice - latestPrevClose) / latestPrevClose) * 100, 2)
    ELSE NULL
  END as calculatedPct,
  lastChangePct as pct_DB
FROM Ticker 
WHERE symbol = 'NVDA';" 2>&1 && \
echo "" && \
echo "=== 3. Výpočet marketCapDiff ===" && \
sqlite3 "$DB" "SELECT 
  symbol,
  lastMarketCap as marketCap,
  latestPrevClose as prevClose,
  lastPrice as currentPrice,
  CASE 
    WHEN latestPrevClose > 0 THEN ROUND(((lastPrice - latestPrevClose) / latestPrevClose) * 100, 2)
    ELSE NULL
  END as calculatedPct,
  CASE 
    WHEN lastMarketCap > 0 AND latestPrevClose > 0 THEN ROUND(lastMarketCap * ((lastPrice - latestPrevClose) / latestPrevClose), 2)
    ELSE NULL
  END as calculated_capDiff,
  lastMarketCapDiff as capDiff_DB
FROM Ticker 
WHERE symbol = 'NVDA';" 2>&1 && \
echo "" && \
echo "✅ Hotovo!"

