# ðŸ”§ OPRAVIÅ¤ SYNTHETIC TESTS - Proces sa reÅ¡tartuje kvÃ´li zlyhÃ¡vajÃºcim testom

cd /var/www/earnings-table && \
echo "=== 1. SKONTROLOVAÅ¤ SYNTHETIC TESTS V KÃ“DE ===" && \
grep -r -i "synthetic.*test\|SYNTHETIC.*FAILED" modules/cron/src/ 2>/dev/null | head -20 || echo "âš ï¸ NenÃ¡jdenÃ©" && \
echo "" && \
echo "=== 2. SKONTROLOVAÅ¤, ÄŒI EXISTUJE KONFIGURÃCIA PRE VYPNUTIE TESTOV ===" && \
grep -r -i "synthetic.*disable\|test.*skip\|SKIP.*TEST" modules/cron/ 2>/dev/null | head -10 || echo "âš ï¸ NenÃ¡jdenÃ©" && \
echo "" && \
echo "=== 3. DOÄŒASNÃ‰ RIEÅ ENIE - VYPNÃšÅ¤ AUTORESTART (aby proces nebol reÅ¡tartovanÃ½) ===" && \
echo "PoznÃ¡mka: Toto NIE JE ideÃ¡lne rieÅ¡enie, ale doÄasne pomÃ´Å¾e" && \
pm2 stop earnings-cron && \
echo "" && \
echo "=== 4. SKONTROLOVAÅ¤ ECOSYSTEM CONFIG ===" && \
grep -A 5 "earnings-cron" ecosystem.config.js | grep -E "(autorestart|max_restarts)" && \
echo "" && \
echo "=== 5. DOÄŒASNÃ‰ RIEÅ ENIE - ZMENIÅ¤ AUTORESTART NA FALSE ===" && \
echo "âš ï¸ POZOR: Toto je doÄasnÃ© rieÅ¡enie! SyntetickÃ© testy by mali byÅ¥ opravenÃ©!" && \
sed -i 's/autorestart: true/autorestart: false/' ecosystem.config.js && \
echo "âœ… ZmenenÃ© autorestart na false" && \
echo "" && \
echo "=== 6. SPUSTIÅ¤ earnings-cron ZNOVU ===" && \
pm2 start ecosystem.config.js --only earnings-cron --env production && \
sleep 5 && \
echo "" && \
echo "=== 7. PM2 STATUS ===" && \
pm2 list | grep earnings-cron && \
echo "" && \
echo "=== 8. POÄŒKAÅ¤ 30 SEKÃšND A SKONTROLOVAÅ¤, ÄŒI SA NAÄŒÃTAVAJÃš DÃTA ===" && \
sleep 30 && \
sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as pocet FROM final_report;" 2>/dev/null && \
echo "" && \
echo "=== 9. PM2 LOGY (novÃ©) ===" && \
pm2 logs earnings-cron --lines 20 --nostream 2>&1 | tail -15 && \
echo "" && \
echo "âœ… Hotovo!"

