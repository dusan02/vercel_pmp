# üîê POSTUPN√â PR√çKAZY - NASTAVENIE SSL PRE PREMARKETPRICE.COM
# Ste prihl√°sen√Ω v SSH (root@89.185.250.213)

# ============================================
# KROK 1: Prejs≈• do premarketprice repozit√°ra
# ============================================
cd /var/www/premarketprice

# Overenie, ≈æe ste na spr√°vnom mieste:
pwd
ls -la

# ============================================
# KROK 2: Aktualiz√°cia syst√©mu
# ============================================
apt update

# ============================================
# KROK 3: In≈°tal√°cia Certbot (ak nie je nain≈°talovan√Ω)
# ============================================
apt install -y certbot python3-certbot-nginx

# Overenie in≈°tal√°cie:
certbot --version

# ============================================
# KROK 4: Otvorenie firewall portov (80, 443)
# ============================================
ufw allow 80/tcp
ufw allow 443/tcp
ufw reload

# Overenie:
ufw status | grep -E '(80|443)'

# ============================================
# KROK 5: Kontrola DNS (overenie, ≈æe dom√©na smeruje na server)
# ============================================
dig premarketprice.com +short
dig www.premarketprice.com +short

# Mali by ste vidie≈•: 89.185.250.213

# ============================================
# KROK 6: Kontrola Nginx (syntax a status)
# ============================================
nginx -t

# Ak je chyba, opravte ju pred pokraƒçovan√≠m

# Kontrola, ƒçi Nginx be≈æ√≠:
systemctl status nginx

# Ak nebe≈æ√≠, spusti≈•:
# systemctl start nginx
# systemctl enable nginx

# ============================================
# KROK 7: VYTVORENIE SSL CERTIFIK√ÅTU (HLAVN√ù KROK)
# ============================================
# Certbot automaticky:
# - N√°jde Nginx config
# - Prid√° HTTPS
# - Nastav√≠ auto-renew

certbot --nginx -d premarketprice.com -d www.premarketprice.com

# Poƒças procesu:
# - Certbot sa m√¥≈æe op√Ωta≈• na e-mail (pre upozornenia)
# - Certbot sa m√¥≈æe op√Ωta≈•, ƒçi chcete presmerova≈• HTTP na HTTPS ‚Üí odpovedzte √ÅNO (Y)

# ============================================
# KROK 8: Overenie, ƒçi sa certifik√°ty vygenerovali
# ============================================
ls -la /etc/letsencrypt/live/premarketprice.com/

# Mali by ste vidie≈•:
# - fullchain.pem
# - privkey.pem
# - cert.pem
# - chain.pem

# ============================================
# KROK 9: Re≈°tart Nginx (aby sa pou≈æili nov√© certifik√°ty)
# ============================================
systemctl restart nginx

# Overenie, ƒçi Nginx be≈æ√≠ spr√°vne:
systemctl status nginx

# ============================================
# KROK 10: Test SSL (overenie, ≈æe HTTPS funguje)
# ============================================
curl -I https://premarketprice.com
curl -I https://www.premarketprice.com

# Mali by ste vidie≈•: HTTP/2 200 alebo podobn√©

# ============================================
# KROK 11: Test HTTP ‚Üí HTTPS presmerovanie
# ============================================
curl -I http://premarketprice.com

# Mali by ste vidie≈•: HTTP/1.1 301 Moved Permanently
# Location: https://premarketprice.com

# ============================================
# KROK 12: Overenie automatick√©ho obnovovania
# ============================================
certbot renew --dry-run

# Toto by malo prebehn√∫≈• bez ch√Ωb

# ============================================
# ‚úÖ HOTOVO!
# ============================================
# SSL je nastaven√Ω a funguje!
# 
# Overte v prehliadaƒçi:
# - https://premarketprice.com
# - https://www.premarketprice.com
#
# Online SSL test:
# - https://www.ssllabs.com/ssltest/analyze.html?d=premarketprice.com

