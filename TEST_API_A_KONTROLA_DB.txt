cd /var/www/premarketprice && \
DB="prisma/data/premarket.db" && \
echo "=== 1. KONTROLA: Hodnoty v DB PRED API volaním ===" && \
sqlite3 "$DB" "SELECT symbol, lastPrice, latestPrevClose, lastChangePct, lastMarketCap, lastMarketCapDiff, sharesOutstanding FROM Ticker WHERE symbol IN ('NVDA', 'GOOG', 'MSFT') ORDER BY lastMarketCap DESC;" 2>&1 && \
echo "" && \
echo "=== 2. TEST API - Volanie /api/stocks?limit=5 ===" && \
curl -s "http://localhost:3000/api/stocks?limit=5" 2>&1 | head -200 > /tmp/api_response.json && \
echo "API odpoveď uložená do /tmp/api_response.json" && \
echo "" && \
echo "=== 3. POČKANIE 5 SEKÚND ===" && \
sleep 5 && \
echo "" && \
echo "=== 4. KONTROLA: Hodnoty v DB PO API volaní ===" && \
sqlite3 "$DB" "SELECT symbol, lastPrice, latestPrevClose, lastChangePct, lastMarketCap, lastMarketCapDiff, sharesOutstanding FROM Ticker WHERE symbol IN ('NVDA', 'GOOG', 'MSFT') ORDER BY lastMarketCap DESC;" 2>&1 && \
echo "" && \
echo "=== 5. PM2 LOGY - posledných 50 riadkov ===" && \
pm2 logs premarketprice --lines 50 --nostream 2>&1 | tail -50 && \
echo "" && \
echo "=== 6. EXTRÁHOVANIE marketCapDiff z API odpovede ===" && \
python3 -c "
import json
try:
    with open('/tmp/api_response.json', 'r') as f:
        data = json.load(f)
    if 'data' in data:
        for stock in data['data'][:10]:
            print(f\"{stock.get('ticker', 'N/A'):6} | marketCapDiff: {stock.get('marketCapDiff', 0):8.2f}B | percentChange: {stock.get('percentChange', 0):6.2f}% | marketCap: {stock.get('marketCap', 0):8.2f}B\")
    else:
        print('⚠️ Neplatná štruktúra odpovede')
except Exception as e:
    print(f'⚠️ Chyba: {e}')
" 2>&1 || echo "⚠️ Python nie je dostupný" && \
echo "" && \
echo "✅ Hotovo!"

