# 游 KOMPLETN츼 OPRAVA - Kop칤rova콘 a spusti콘 na serveri

# === KROK 1: Prejs콘 do adres치ra ===
cd /var/www/premarketprice

# === KROK 2: Opravi콘 PORT v .env (ak existuje) ===
# Skontrolova콘
cat .env | grep PORT

# Odstr치ni콘 PORT=3001 alebo zmeni콘 na PORT=3000
sed -i '/^PORT=3001/d' .env
# Alebo ak chcete explicitne nastavi콘:
# echo "PORT=3000" >> .env

# === KROK 3: Zastavi콘 v코etky star칠 procesy ===
pm2 stop all
pm2 delete all

# === KROK 4: Spusti콘 v코etky procesy z ecosystem.config.js ===
pm2 start ecosystem.config.js --env production

# === KROK 5: Skontrolova콘 status ===
pm2 status

# Mali by ste vidie콘:
# - premarketprice (online)
# - pmp-polygon-worker (online)
# - pmp-bulk-preloader (online alebo waiting)

# === KROK 6: Ulo쬴콘 ===
pm2 save

# === KROK 7: Skontrolova콘 port 3000 ===
pm2 logs premarketprice --lines 10
# Mali by ste vidie콘: "游 Next.js server ready on http://localhost:3000"

netstat -tlnp | grep 3000
# Mali by ste vidie콘: 127.0.0.1:3000

# === KROK 8: Skontrolova콘 workers ===
pm2 logs pmp-polygon-worker --lines 10
pm2 logs pmp-bulk-preloader --lines 10

