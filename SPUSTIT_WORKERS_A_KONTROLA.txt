# ✅ SERVER BEŽÍ NA PORTE 3000! Teraz spustiť workers a skontrolovať

# === KROK 1: Skontrolovať porty ===
ss -tlnp | grep -E "3000|3001"

# Mali by ste vidieť: LISTEN 0 511 127.0.0.1:3000
# NIE: *:3001

# === KROK 2: Spustiť workers ===
cd /var/www/premarketprice
pm2 start ecosystem.config.js --only pmp-polygon-worker --env production
pm2 start ecosystem.config.js --only pmp-bulk-preloader --env production

# === KROK 3: Skontrolovať všetky procesy ===
pm2 status

# Mali by ste vidieť:
# - premarketprice (online) - port 3000 ✅
# - pmp-polygon-worker (online)
# - pmp-bulk-preloader (online alebo waiting)

# === KROK 4: Uložiť ===
pm2 save

# === KROK 5: Skontrolovať logy workers ===
pm2 logs pmp-polygon-worker --lines 10
pm2 logs pmp-bulk-preloader --lines 10

# === KROK 6: Skontrolovať, či Nginx môže pripojiť na port 3000 ===
curl http://localhost:3000/api/health
# Alebo
curl http://127.0.0.1:3000/api/health

# Mali by ste dostať odpoveď (napr. "healthy" alebo JSON)

# === KROK 7: Skontrolovať Nginx konfiguráciu ===
nginx -t

# Mali by ste vidieť: "syntax is ok" a "test is successful"

# === KROK 8: Ak je Nginx konfigurácia OK, reload ===
systemctl reload nginx

# === KROK 9: Testovať cez doménu (ak je DNS nastavené) ===
# curl https://premarketprice.com/api/health
# Alebo
# curl http://premarketprice.com/api/health

